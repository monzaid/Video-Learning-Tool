# SRT字幕转TXT工具

一个功能强大的SRT字幕文件转换工具，支持将SRT字幕文件批量转换为TXT文本文件，提供直观的图形用户界面和丰富的功能选项。

## 功能特性

### 🎯 核心功能
- **批量转换**：支持同时处理多个SRT文件
- **智能解析**：自动解析SRT字幕格式，提取纯文本内容
- **多种输出模式**：
  - 分别输出：每个SRT文件对应生成一个TXT文件
  - 合并输出：将多个SRT文件合并为一个TXT文件
  - 按文件夹合并：递归搜索时可按文件夹分别生成summary.txt

### 📁 文件管理
- **多种文件选择方式**：
  - 手动选择单个或多个SRT文件
  - 选择文件夹（支持递归搜索子文件夹）
  - 拖拽文件到界面（需安装tkinterdnd2）
  - Ctrl+V粘贴文件路径
- **智能文件过滤**：自动识别.srt文件
- **文件列表管理**：支持全选、取消全选、反向选择、删除选中文件

### 🔍 搜索与排序
- **实时搜索**：支持文件名搜索，可选择正则表达式模式
- **多种排序方式**：
  - 原序列（按添加顺序）
  - 文件名升序/降序
  - 已勾选优先/未勾选优先
  - 支持组合排序（如：已勾选优先+文件名升序）
- **搜索结果处理**：可选择只处理搜索结果中的文件

### 🎨 界面功能
- **直观的GUI界面**：基于tkinter构建，界面友好
- **文件路径显示**：可选择显示完整路径或仅文件名
- **拖拽框选**：支持鼠标拖拽框选多个文件进行反选操作
- **右键菜单**：丰富的右键操作选项
- **工具提示**：鼠标悬停显示完整文件路径

### 🛠️ 高级功能
- **文件预览**：右键预览转换结果，支持编辑后保存
- **文件对比**：覆盖文件时可对比新旧内容
- **多编码支持**：自动尝试UTF-8、GBK、Latin-1编码
- **输出路径自定义**：可指定统一输出文件夹
- **文件覆盖控制**：支持全部覆盖/全部不覆盖选项

## 安装要求

### 基本要求
- Python 3.6+
- tkinter（通常随Python安装）

### 可选依赖
```bash
# 安装拖拽功能支持（推荐）
pip install tkinterdnd2>=0.3.0

# 如需打包成exe文件
pip install pyinstaller>=5.0
```

### 快速安装
```bash
# 克隆项目
git clone git@github.com:monzaid/Video-Learning-Tool.git
cd Video-Learning-Tool

# 安装依赖
pip install -r requirements.txt
```

## 使用方法

### 启动程序
```bash
python srt_to_txt_converter.py
```

### 基本操作流程

1. **添加文件**
   - 点击"选择SRT文件"按钮选择单个或多个文件
   - 点击"选择文件夹"按钮选择包含SRT文件的文件夹
   - 勾选"递归搜索子文件夹"可搜索所有子目录
   - 直接拖拽SRT文件到文件列表区域
   - 使用Ctrl+V粘贴复制的文件路径

2. **文件管理**
   - 勾选要处理的文件（默认全选）
   - 使用搜索框过滤文件列表
   - 选择合适的排序方式
   - 可选择显示完整路径或仅文件名

3. **设置输出选项**
   - 选择输出模式：分别输出或合并输出
   - 合并输出时可选择显示被合成文件的绝对路径
   - 递归搜索时可选择按文件夹合并
   - 可指定统一的输出文件夹

4. **执行转换**
   - 点击"转换选中文件"按钮开始转换
   - 程序会自动处理文件覆盖确认
   - 转换完成后显示结果统计

### 高级功能使用

#### 右键菜单功能
在文件列表中右键点击文件可使用以下功能：
- **预览转换结果**：查看转换后的文本内容，支持编辑和保存
- **转换当前文件**：单独转换选中的文件
- **复制路径**：复制文件的绝对路径到剪贴板
- **在文件资源管理器中显示**：打开文件所在位置
- **打开文件**：用系统默认编辑器打开SRT文件

#### 搜索功能
- **普通搜索**：输入关键词搜索文件名
- **正则表达式搜索**：勾选"正则表达式"选项使用正则模式
- **只处理搜索结果**：勾选此选项仅转换搜索结果中的文件

#### 排序功能
- **原序列**：按文件添加顺序排列
- **文件名排序**：按文件名字母顺序排列（升序/降序）
- **勾选状态排序**：已勾选或未勾选的文件优先显示
- **组合排序**：可同时使用多种排序条件

## 输出格式

### 分别输出模式
- 每个SRT文件生成对应的TXT文件
- 输出文件名：`原文件名.txt`
- 如果输出到统一文件夹：`原文件名(绝对父目录路径).txt`

### 合并输出模式
- 所有选中文件合并为一个TXT文件
- 格式：
  ```
  文件名1
  字幕内容1，字幕内容2，...，
  
  文件名2
  字幕内容1，字幕内容2，...，
  ```

### 按文件夹合并模式
- 每个文件夹生成一个`summary.txt`文件
- 包含该文件夹下所有SRT文件的内容
- 如果输出到统一文件夹：`summary(文件夹路径).txt`

## 技术实现

### 核心类结构
- **SRTToTXTConverter**：主应用程序类，包含所有GUI和业务逻辑

### 主要方法分类

#### GUI创建与管理
- [`create_widgets()`](srt_to_txt_converter.py:51)：创建主界面
- [`bind_mousewheel()`](srt_to_txt_converter.py:485)：绑定鼠标滚轮事件
- [`create_tooltip()`](srt_to_txt_converter.py:458)：创建工具提示

#### 文件管理
- [`select_files()`](srt_to_txt_converter.py:336)：选择单个或多个文件
- [`select_folder()`](srt_to_txt_converter.py:359)：选择文件夹并搜索SRT文件
- [`add_file_item()`](srt_to_txt_converter.py:391)：添加文件到列表
- [`clear_all_files()`](srt_to_txt_converter.py:814)：清空文件列表

#### 搜索与排序
- [`filter_file_list()`](srt_to_txt_converter.py:736)：根据搜索条件过滤文件
- [`sort_file_list()`](srt_to_txt_converter.py:628)：文件列表排序
- [`on_sort_option_changed()`](srt_to_txt_converter.py:539)：排序选项变化处理

#### 文件转换
- [`parse_srt_file()`](srt_to_txt_converter.py:1064)：解析SRT文件内容
- [`convert_separate()`](srt_to_txt_converter.py:1120)：分别转换模式
- [`convert_merge_all()`](srt_to_txt_converter.py:1271)：合并所有文件
- [`convert_merge_by_folder()`](srt_to_txt_converter.py:1186)：按文件夹合并

#### 交互功能
- [`on_drag_start()`](srt_to_txt_converter.py:867)：拖拽框选开始
- [`on_file_drop()`](srt_to_txt_converter.py:1995)：文件拖拽放下处理
- [`on_paste_files()`](srt_to_txt_converter.py:1900)：粘贴文件路径处理
- [`show_file_context_menu()`](srt_to_txt_converter.py:1471)：显示右键菜单

#### 预览与对比
- [`preview_conversion_result()`](srt_to_txt_converter.py:1492)：预览转换结果
- [`show_file_comparison()`](srt_to_txt_converter.py:1759)：显示文件对比
- [`check_file_overwrite()`](srt_to_txt_converter.py:1345)：文件覆盖检查

### 特殊功能实现

#### 多编码支持
程序自动尝试多种编码格式读取SRT文件：
1. UTF-8（优先）
2. GBK（中文编码）
3. Latin-1（兜底编码）

#### 拖拽功能
- 使用tkinterdnd2库实现文件拖拽
- 支持单文件和文件夹拖拽
- 自动递归搜索文件夹中的SRT文件

#### 路径处理
- 跨平台路径处理，支持Windows、macOS、Linux
- 自动处理路径分隔符
- 支持文件名特殊字符清理

## 系统兼容性

### 支持的操作系统
- **Windows**：完全支持，包括文件管理器集成
- **macOS**：支持，使用系统默认应用
- **Linux**：支持，自动检测可用的文件管理器和编辑器

### 文件管理器集成
- **Windows**：使用`explorer /select`命令
- **macOS**：使用`open -R`命令
- **Linux**：支持多种文件管理器（nautilus、dolphin、thunar等）

### 文本编辑器集成
- **Windows**：使用记事本(notepad.exe)
- **macOS**：使用TextEdit
- **Linux**：自动检测可用编辑器（gedit、kate、mousepad等）

## 错误处理

程序具有完善的错误处理机制：
- 文件读取错误（编码问题、权限问题）
- 文件写入错误（磁盘空间、权限问题）
- 路径处理错误（无效路径、特殊字符）
- GUI操作错误（控件销毁、事件处理）

## 开发说明

### 代码结构
- 单文件应用程序，便于分发和维护
- 面向对象设计，功能模块化
- 完整的错误处理和用户反馈
- 支持可选依赖的优雅降级

### 扩展性
- 易于添加新的输出格式
- 可扩展的文件类型支持
- 模块化的GUI组件设计

## 许可证

本项目采用开源许可证，具体许可证信息请查看项目根目录的LICENSE文件。

## 贡献

欢迎提交Issue和Pull Request来改进这个工具！

## 更新日志

### 当前版本特性
- 完整的GUI界面
- 多种文件选择方式
- 灵活的输出选项
- 强大的搜索和排序功能
- 丰富的右键菜单操作
- 跨平台兼容性
- 完善的错误处理机制